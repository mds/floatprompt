# Output Templates

## Two-Stage Templating

Stage 1 compiles **tool templates** ‚Üí tool `.md` files.

Stage 2 compiles **output templates** ‚Üí nav/context `.md` files.

This section covers Stage 2: the outputs that tools generate.

---

## The Insight

Tools don't just exist as templates ‚Äî their **output** is also templated.

When `npm float sync` runs:
1. Scans actual folder structure
2. Loads descriptions (from config or frontmatter)
3. Renders nav template with scanned data
4. Outputs fresh nav `.md` file

The nav file isn't manually maintained. It's generated from reality.

---

## Nav Templates

### nav-folder.hbs

Generates a nav file for a single folder:

```handlebars
# {{folder.name}}/

{{#if folder.description}}
{{folder.description}}
{{/if}}

| File | Description |
|------|-------------|
{{#each folder.files}}
| `{{name}}` | {{#if description}}{{description}}{{else}}[needs description]{{/if}} |
{{/each}}

{{#if folder.subfolders}}
## Subfolders

{{#each folder.subfolders}}
- [`{{name}}/`]({{name}}.md){{#if description}} ‚Äî {{description}}{{/if}}
{{/each}}
{{/if}}

---

*Generated by float-sync ¬∑ {{timestamp}}*
```

### Scan Data Shape

```json
{
  "folder": {
    "name": "docs",
    "path": "docs/",
    "description": "Project documentation",
    "files": [
      { "name": "README.md", "description": "Overview" },
      { "name": "API.md", "description": null }
    ],
    "subfolders": [
      { "name": "guides", "path": "docs/guides/", "description": "How-to guides" }
    ]
  },
  "timestamp": "2025-12-31T12:00:00Z"
}
```

### Generated Output

```markdown
# docs/

Project documentation

| File | Description |
|------|-------------|
| `README.md` | Overview |
| `API.md` | [needs description] |

## Subfolders

- [`guides/`](guides.md) ‚Äî How-to guides

---

*Generated by float-sync ¬∑ 2025-12-31T12:00:00Z*
```

---

## Context Templates

### context-map.hbs

Generates a project context map:

```handlebars
# {{project.name}} Context

**Version:** {{system.version}}
**Generated:** {{timestamp}}
**Author:** {{system.author}}

## Overview

{{project.description}}

## Domains

{{#each domains}}
### {{name}}

{{description}}

**Key files:**
{{#each files}}
- `{{path}}`: {{purpose}}
{{/each}}

{{/each}}

## Architecture

{{#if architecture}}
{{architecture}}
{{else}}
[Architecture description needed]
{{/if}}

## Key Decisions

{{#each decisions}}
- **{{title}}**: {{summary}}
{{/each}}

---

*Generated by float-context ¬∑ {{timestamp}}*
```

---

## Description Sources

Where do file descriptions come from?

### Option A: Frontmatter (in-file)

```markdown
---
description: "API reference documentation"
---

# API Reference
...
```

Scanner extracts `description` from frontmatter.

### Option B: Description Files (per-folder)

```json
// docs/.descriptions.json
{
  "README.md": "Project overview and quick start",
  "API.md": "API reference documentation",
  "guides/": "How-to guides for common tasks"
}
```

Scanner loads descriptions from JSON file.

### Option C: Central Registry

```json
// .float/descriptions.json
{
  "docs/README.md": "Project overview",
  "docs/API.md": "API reference",
  "src/index.js": "Application entry point"
}
```

Single source of truth for all descriptions.

### Option D: AI-Inferred

Scanner reads file content, AI generates description.

```javascript
async function inferDescription(filePath, content) {
  const response = await anthropic.messages.create({
    model: 'claude-sonnet-4-20250514',
    messages: [{
      role: 'user',
      content: `Describe this file in one sentence:\n\n${content.slice(0, 1000)}`
    }]
  });
  return response.content[0].text;
}
```

### Recommended: Hybrid

1. Check frontmatter first
2. Fall back to .descriptions.json
3. Mark as `[needs description]` if neither exists
4. AI inference as optional enhancement

---

## MDS Trifecta Templates

For deep contextual anchors, generate all three:

### outputs/mds-trifecta/map.hbs

```handlebars
# {{anchor.name}} ‚Äî Map

**WHERE things are**

Generated: {{timestamp}}

## Structure

{{#each structure}}
{{indent}}{{#if isFolder}}üìÅ{{else}}üìÑ{{/if}} {{name}}{{#if description}} ‚Äî {{description}}{{/if}}
{{/each}}

## Relationships

{{#each relationships}}
- {{from}} ‚Üí {{to}}: {{type}}
{{/each}}

## Navigation

{{#each navigation}}
- [{{label}}]({{path}})
{{/each}}
```

### outputs/mds-trifecta/decisions.hbs

```handlebars
# {{anchor.name}} ‚Äî Decisions

**WHY things are this way**

Generated: {{timestamp}}

## Key Decisions

{{#each decisions}}
### {{title}}

**Choice:** {{choice}}

**Alternatives considered:**
{{#each alternatives}}
- {{this}}
{{/each}}

**Rationale:** {{rationale}}

{{#if revisit}}
**May revisit:** {{revisit}}
{{/if}}

{{/each}}

## Trade-offs

{{#each tradeoffs}}
- **{{name}}**: {{description}}
{{/each}}
```

### outputs/mds-trifecta/structure.hbs

```handlebars
# {{anchor.name}} ‚Äî Structure

**WHAT this is (deep context)**

Generated: {{timestamp}}

## Purpose

{{anchor.purpose}}

## Description

{{anchor.description}}

## How It Works

{{#each mechanics}}
### {{title}}

{{description}}

{{#if steps}}
{{#each steps}}
{{@index_1}}. {{this}}
{{/each}}
{{/if}}

{{/each}}

## Interfaces

{{#each interfaces}}
### {{name}}

{{description}}

{{#if signature}}
```
{{signature}}
```
{{/if}}

{{/each}}

## Context Dependencies

{{#each dependencies}}
- **{{name}}**: {{why}}
{{/each}}
```

---

## Generation Commands

```bash
# Generate all nav files
npm float build:nav

# Generate all context files
npm float build:context

# Generate MDS trifecta for specific anchor
npm float anchor create tools

# Regenerate from scan (sync reality ‚Üí templates ‚Üí output)
npm float sync
```

---

## Freshness Tracking

Output files include generation timestamp:

```markdown
---
*Generated by float-sync ¬∑ 2025-12-31T12:00:00Z*
```

Validation can check:
- Is output older than source?
- Has folder structure changed since generation?
- Are descriptions stale?

```bash
npm float validate --freshness
# Warning: docs.md generated 7 days ago, folder modified 2 days ago
```
